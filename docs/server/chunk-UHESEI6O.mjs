import './polyfills.server.mjs';
import{a as c}from"./chunk-YVI223GE.mjs";import{Y as g}from"./chunk-7JPNWG76.mjs";var y=Symbol.for("[int-v1]"),a=class{constructor(r,t,e=36e5,i=y.toString()){this.storage=r;this.storageEngineProvider=t;this.ttlGlobal=e;this.version=i}prefixKey="[cache]:";set(r,t,e){let i=this.getPrefixedKey(r),o=e?.ttl??this.ttlGlobal,s=o?Date.now()+o:null,h=e?.version||this.version;(e?.storage?this.storageEngineProvider(e?.storage):this.storage).set(i,JSON.stringify({value:t,expiry:s,version:h}))}get(r,t){if(!this.verifyVersion(r,t))return null;let e=t?this.storageEngineProvider(t):this.storage,i=this.getPrefixedKey(r),o=e.get(i);if(!o)return null;try{let s=JSON.parse(o);return s?.expiry&&Date.now()>s.expiry?(e.remove(i),null):s.value}catch{return null}}has(r,t){if(!this.verifyVersion(r,t))return!1;let e=t?this.storageEngineProvider(t):this.storage,i=this.getPrefixedKey(r),o=e.get(i);if(!o)return!1;try{let s=JSON.parse(o);return s.expiry&&Date.now()>s.expiry?(e.remove(i),!1):!0}catch{return!1}}remove(r,t){let e=t?this.storageEngineProvider(t):this.storage,i=this.getPrefixedKey(r);e.remove(i)}clear(r){(r?[this.storageEngineProvider(r)]:[this.storageEngineProvider("local"),this.storageEngineProvider("session"),this.storageEngineProvider("memory"),this.storage]).forEach(e=>{let i=[];for(let o=0;o<e.length();o++){let s=e.key(o);s&&s.startsWith(this.prefixKey)&&i.push(s)}i.forEach(o=>e.remove(o))})}verifyVersion(r,t){let e=t?this.storageEngineProvider(t):this.storage,i=this.getPrefixedKey(r),o=e.get(i);if(!o)return!0;try{if(JSON.parse(o).version!==this.version)return e.remove(i),!1}catch{return!0}return!0}getPrefixedKey(r){return`${this.prefixKey}${r}`}};var p=new g("CACHE_SERVICE");function C(n){return[{provide:p,useFactory:()=>{let r=c(n?.storage,n?.storagePrefix);return new a(r,c,n?.ttl,n?.version)}}]}export{p as a,C as b};
