import{b as g,c}from"./chunk-VCAENKN4.js";import{V as y}from"./chunk-KLGW5RVA.js";var l=Symbol.for("[int-v1]"),a=class{constructor(r,t,e=36e5,n=l.toString()){this.storage=r;this.storageEngineProvider=t;this.ttlGlobal=e;this.version=n}prefixKey="[cache]:";set(r,t,e){let n=this.getPrefixedKey(r),o=e?.ttl??this.ttlGlobal,i=o?Date.now()+o:null,f=e?.version||this.version;(e?.storage?this.storageEngineProvider(e?.storage):this.storage).set(n,JSON.stringify({value:t,expiry:i,version:f}))}get(r,t){if(!this.verifyVersion(r,t))return null;let e=t?this.storageEngineProvider(t):this.storage,n=this.getPrefixedKey(r),o=e.get(n);if(!o)return null;try{let i=JSON.parse(o);return i?.expiry&&Date.now()>i.expiry?(e.remove(n),null):i.value}catch{return null}}has(r,t){if(!this.verifyVersion(r,t))return!1;let e=t?this.storageEngineProvider(t):this.storage,n=this.getPrefixedKey(r),o=e.get(n);if(!o)return!1;try{let i=JSON.parse(o);return i.expiry&&Date.now()>i.expiry?(e.remove(n),!1):!0}catch{return!1}}remove(r,t){let e=t?this.storageEngineProvider(t):this.storage,n=this.getPrefixedKey(r);e.remove(n)}clear(r){(r?[this.storageEngineProvider(r)]:[this.storageEngineProvider("local"),this.storageEngineProvider("session"),this.storageEngineProvider("memory"),this.storage]).forEach(e=>{let n=[];for(let o=0;o<e.length();o++){let i=e.key(o);i&&i.startsWith(this.prefixKey)&&n.push(i)}n.forEach(o=>e.remove(o))})}verifyVersion(r,t){let e=t?this.storageEngineProvider(t):this.storage,n=this.getPrefixedKey(r),o=e.get(n);if(!o)return!0;try{if(JSON.parse(o).version!==this.version)return e.remove(n),!1}catch{return!0}return!0}getPrefixedKey(r){return`${this.prefixKey}${r}`}};var h=new Map;function v(s,r){return s.toString()+(r??"")}function p(s="memory",r){if(typeof window>"u")return new c;let t=v(s,r);if(h.has(t))return h.get(t);let e;return s==="local"?e=new g(localStorage,r):s==="session"?e=new g(sessionStorage,r):e=new c,h.set(t,e),e}var u=new y("CACHE_SERVICE");function w(s){return[{provide:u,useFactory:()=>{let r=p(s?.storage,s?.storagePrefix);return new a(r,p,s?.ttl,s?.version)}}]}export{a,p as b,u as c,w as d};
